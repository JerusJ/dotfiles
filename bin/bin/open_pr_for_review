#!/usr/bin/env bash

set -eux

PR_NUMBER="$1"
REPO_NAME="$2"
REPO_PATH="$3"
HEAD_REF_NAME="$4"

TMUX_NAME="PR-${PR_NUMBER}-${REPO_NAME}"

cat <<EOF >/tmp/test
PR_NUMBER="${PR_NUMBER}"
REPO_NAME="${REPO_NAME}"
REPO_PATH="${REPO_PATH}"
HEAD_REF_NAME="${HEAD_REF_NAME}"
EOF

EXTRA_COMMANDS="cd_worktree '$REPO_PATH' '$HEAD_REF_NAME' '$PR_NUMBER'"
tmux list-sessions -F '#S' | grep -qx "$TMUX_NAME" || tmux new-session -s "$TMUX_NAME" -d "${EXTRA_COMMANDS}; ${SHELL}"
